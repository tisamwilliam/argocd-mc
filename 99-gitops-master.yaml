apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    app.kubernetes.io/instance: machine-config
    machineconfiguration.openshift.io/role: master
  name: 99-gitops-master
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
      - contents:
          compression: ""
          source: data:text/plain;charset=utf-8;base64,IwojIFBsZWFzZSBub3RlIHRoYXQgdGhlIHBhcmFtZXRlcnMgaW4gdGhpcyBjb25maWd1cmF0aW9uIGZpbGUgY29udHJvbCB0aGUKIyBiZWhhdmlvciBvZiB0aGUgdG9vbHMgZnJvbSB0aGUgc2hhZG93LXV0aWxzIGNvbXBvbmVudC4gTm9uZSBvZiB0aGVzZQojIHRvb2xzIHVzZXMgdGhlIFBBTSBtZWNoYW5pc20sIGFuZCB0aGUgdXRpbGl0aWVzIHRoYXQgdXNlIFBBTSAoc3VjaCBhcyB0aGUKIyBwYXNzd2QgY29tbWFuZCkgc2hvdWxkIHRoZXJlZm9yZSBiZSBjb25maWd1cmVkIGVsc2V3aGVyZS4gUmVmZXIgdG8KIyAvZXRjL3BhbS5kL3N5c3RlbS1hdXRoIGZvciBtb3JlIGluZm9ybWF0aW9uLgojCgojICpSRVFVSVJFRCoKIyAgIERpcmVjdG9yeSB3aGVyZSBtYWlsYm94ZXMgcmVzaWRlLCBfb3JfIG5hbWUgb2YgZmlsZSwgcmVsYXRpdmUgdG8gdGhlCiMgICBob21lIGRpcmVjdG9yeS4gIElmIHlvdSBfZG9fIGRlZmluZSBib3RoLCBNQUlMX0RJUiB0YWtlcyBwcmVjZWRlbmNlLgojICAgUU1BSUxfRElSIGlzIGZvciBRbWFpbAojCiNRTUFJTF9ESVIJTWFpbGRpcgpNQUlMX0RJUgkvdmFyL3Nwb29sL21haWwKI01BSUxfRklMRQkubWFpbAoKIyBEZWZhdWx0IGluaXRpYWwgInVtYXNrIiB2YWx1ZSB1c2VkIGJ5IGxvZ2luKDEpIG9uIG5vbi1QQU0gZW5hYmxlZCBzeXN0ZW1zLgojIERlZmF1bHQgInVtYXNrIiB2YWx1ZSBmb3IgcGFtX3VtYXNrKDgpIG9uIFBBTSBlbmFibGVkIHN5c3RlbXMuCiMgVU1BU0sgaXMgYWxzbyB1c2VkIGJ5IHVzZXJhZGQoOCkgYW5kIG5ld3VzZXJzKDgpIHRvIHNldCB0aGUgbW9kZSBmb3IgbmV3CiMgaG9tZSBkaXJlY3RvcmllcyBpZiBIT01FX01PREUgaXMgbm90IHNldC4KIyAwMjIgaXMgdGhlIGRlZmF1bHQgdmFsdWUsIGJ1dCAwMjcsIG9yIGV2ZW4gMDc3LCBjb3VsZCBiZSBjb25zaWRlcmVkCiMgZm9yIGluY3JlYXNlZCBwcml2YWN5LiBUaGVyZSBpcyBubyBPbmUgVHJ1ZSBBbnN3ZXIgaGVyZTogZWFjaCBzeXNhZG1pbgojIG11c3QgbWFrZSB1cCB0aGVpciBtaW5kLgpVTUFTSwkJMDI3CgojIEhPTUVfTU9ERSBpcyB1c2VkIGJ5IHVzZXJhZGQoOCkgYW5kIG5ld3VzZXJzKDgpIHRvIHNldCB0aGUgbW9kZSBmb3IgbmV3CiMgaG9tZSBkaXJlY3Rvcmllcy4KIyBJZiBIT01FX01PREUgaXMgbm90IHNldCwgdGhlIHZhbHVlIG9mIFVNQVNLIGlzIHVzZWQgdG8gY3JlYXRlIHRoZSBtb2RlLgpIT01FX01PREUJMDcwMAoKIyBQYXNzd29yZCBhZ2luZyBjb250cm9sczoKIwojCVBBU1NfTUFYX0RBWVMJTWF4aW11bSBudW1iZXIgb2YgZGF5cyBhIHBhc3N3b3JkIG1heSBiZSB1c2VkLgojCVBBU1NfTUlOX0RBWVMJTWluaW11bSBudW1iZXIgb2YgZGF5cyBhbGxvd2VkIGJldHdlZW4gcGFzc3dvcmQgY2hhbmdlcy4KIwlQQVNTX01JTl9MRU4JTWluaW11bSBhY2NlcHRhYmxlIHBhc3N3b3JkIGxlbmd0aC4KIwlQQVNTX1dBUk5fQUdFCU51bWJlciBvZiBkYXlzIHdhcm5pbmcgZ2l2ZW4gYmVmb3JlIGEgcGFzc3dvcmQgZXhwaXJlcy4KIwpQQVNTX01BWF9EQVlTCTk5OTk5ClBBU1NfTUlOX0RBWVMJMApQQVNTX01JTl9MRU4JNQpQQVNTX1dBUk5fQUdFCTcKCiMKIyBNaW4vbWF4IHZhbHVlcyBmb3IgYXV0b21hdGljIHVpZCBzZWxlY3Rpb24gaW4gdXNlcmFkZAojClVJRF9NSU4gICAgICAgICAgICAgICAgICAxMDAwClVJRF9NQVggICAgICAgICAgICAgICAgIDYwMDAwCiMgU3lzdGVtIGFjY291bnRzClNZU19VSURfTUlOICAgICAgICAgICAgICAgMjAxClNZU19VSURfTUFYICAgICAgICAgICAgICAgOTk5CgojCiMgTWluL21heCB2YWx1ZXMgZm9yIGF1dG9tYXRpYyBnaWQgc2VsZWN0aW9uIGluIGdyb3VwYWRkCiMKR0lEX01JTiAgICAgICAgICAgICAgICAgIDEwMDAKR0lEX01BWCAgICAgICAgICAgICAgICAgNjAwMDAKIyBTeXN0ZW0gYWNjb3VudHMKU1lTX0dJRF9NSU4gICAgICAgICAgICAgICAyMDEKU1lTX0dJRF9NQVggICAgICAgICAgICAgICA5OTkKCiMKIyBJZiBkZWZpbmVkLCB0aGlzIGNvbW1hbmQgaXMgcnVuIHdoZW4gcmVtb3ZpbmcgYSB1c2VyLgojIEl0IHNob3VsZCByZW1vdmUgYW55IGF0L2Nyb24vcHJpbnQgam9icyBldGMuIG93bmVkIGJ5CiMgdGhlIHVzZXIgdG8gYmUgcmVtb3ZlZCAocGFzc2VkIGFzIHRoZSBmaXJzdCBhcmd1bWVudCkuCiMKI1VTRVJERUxfQ01ECS91c3Ivc2Jpbi91c2VyZGVsX2xvY2FsCgojCiMgSWYgdXNlcmFkZCBzaG91bGQgY3JlYXRlIGhvbWUgZGlyZWN0b3JpZXMgZm9yIHVzZXJzIGJ5IGRlZmF1bHQKIyBPbiBSSCBzeXN0ZW1zLCB3ZSBkby4gVGhpcyBvcHRpb24gaXMgb3ZlcnJpZGRlbiB3aXRoIHRoZSAtbSBmbGFnIG9uCiMgdXNlcmFkZCBjb21tYW5kIGxpbmUuCiMKQ1JFQVRFX0hPTUUJeWVzCgojIFRoaXMgZW5hYmxlcyB1c2VyZGVsIHRvIHJlbW92ZSB1c2VyIGdyb3VwcyBpZiBubyBtZW1iZXJzIGV4aXN0LgojClVTRVJHUk9VUFNfRU5BQiB5ZXMKCiMgVXNlIFNIQTUxMiB0byBlbmNyeXB0IHBhc3N3b3JkLgpFTkNSWVBUX01FVEhPRCBTSEE1MTIKCg==
        mode: 420
        overwrite: true
        path: /etc/login.defs
      - contents:
          compression: ""
          source: data:text/plain;charset=utf-8;base64,IyBVc2UgcHVibGljIHNlcnZlcnMgZnJvbSB0aGUgcG9vbC5udHAub3JnIHByb2plY3QuCiMgUGxlYXNlIGNvbnNpZGVyIGpvaW5pbmcgdGhlIHBvb2wgKGh0dHA6Ly93d3cucG9vbC5udHAub3JnL2pvaW4uaHRtbCkuCnBvb2wgdGVzdC1udHAtMSBpYnVyc3QKcG9vbCB0ZXN0LW50cC0yIGlidXJzdAoKIyBSZWNvcmQgdGhlIHJhdGUgYXQgd2hpY2ggdGhlIHN5c3RlbSBjbG9jayBnYWlucy9sb3NzZXMgdGltZS4KZHJpZnRmaWxlIC92YXIvbGliL2Nocm9ueS9kcmlmdAoKIyBBbGxvdyB0aGUgc3lzdGVtIGNsb2NrIHRvIGJlIHN0ZXBwZWQgaW4gdGhlIGZpcnN0IHRocmVlIHVwZGF0ZXMKIyBpZiBpdHMgb2Zmc2V0IGlzIGxhcmdlciB0aGFuIDEgc2Vjb25kLgptYWtlc3RlcCAxLjAgMwoKIyBFbmFibGUga2VybmVsIHN5bmNocm9uaXphdGlvbiBvZiB0aGUgcmVhbC10aW1lIGNsb2NrIChSVEMpLgpydGNzeW5jCgojIEVuYWJsZSBoYXJkd2FyZSB0aW1lc3RhbXBpbmcgb24gYWxsIGludGVyZmFjZXMgdGhhdCBzdXBwb3J0IGl0LgojaHd0aW1lc3RhbXAgKgoKIyBJbmNyZWFzZSB0aGUgbWluaW11bSBudW1iZXIgb2Ygc2VsZWN0YWJsZSBzb3VyY2VzIHJlcXVpcmVkIHRvIGFkanVzdAojIHRoZSBzeXN0ZW0gY2xvY2suCiNtaW5zb3VyY2VzIDIKCiMgQWxsb3cgTlRQIGNsaWVudCBhY2Nlc3MgZnJvbSBsb2NhbCBuZXR3b3JrLgojYWxsb3cgMTkyLjE2OC4wLjAvMTYKCiMgU2VydmUgdGltZSBldmVuIGlmIG5vdCBzeW5jaHJvbml6ZWQgdG8gYSB0aW1lIHNvdXJjZS4KI2xvY2FsIHN0cmF0dW0gMTAKCiMgU3BlY2lmeSBmaWxlIGNvbnRhaW5pbmcga2V5cyBmb3IgTlRQIGF1dGhlbnRpY2F0aW9uLgprZXlmaWxlIC9ldGMvY2hyb255LmtleXMKCiMgR2V0IFRBSS1VVEMgb2Zmc2V0IGFuZCBsZWFwIHNlY29uZHMgZnJvbSB0aGUgc3lzdGVtIHR6IGRhdGFiYXNlLgpsZWFwc2VjdHogcmlnaHQvVVRDCgojIFNwZWNpZnkgZGlyZWN0b3J5IGZvciBsb2cgZmlsZXMuCmxvZ2RpciAvdmFyL2xvZy9jaHJvbnkKCiMgU2VsZWN0IHdoaWNoIGluZm9ybWF0aW9uIGlzIGxvZ2dlZC4KI2xvZyBtZWFzdXJlbWVudHMgc3RhdGlzdGljcyB0cmFja2luZwo=
        mode: 420
        overwrite: true
        path: /etc/chrony.conf
      - contents:
          compression: ""
          source: data:text/plain;charset=utf-8;base64,dW1hc2sgMDI3Cg==
        mode: 420
        overwrite: true
        path: /etc/profile.d/umask.sh
      - contents:
          compression: ""
          source: data:text/plain;charset=utf-8;base64,IyAvZXRjL2Jhc2hyYwoKIyBTeXN0ZW0gd2lkZSBmdW5jdGlvbnMgYW5kIGFsaWFzZXMKIyBFbnZpcm9ubWVudCBzdHVmZiBnb2VzIGluIC9ldGMvcHJvZmlsZQoKIyBJdCdzIE5PVCBhIGdvb2QgaWRlYSB0byBjaGFuZ2UgdGhpcyBmaWxlIHVubGVzcyB5b3Uga25vdyB3aGF0IHlvdQojIGFyZSBkb2luZy4gSXQncyBtdWNoIGJldHRlciB0byBjcmVhdGUgYSBjdXN0b20uc2ggc2hlbGwgc2NyaXB0IGluCiMgL2V0Yy9wcm9maWxlLmQvIHRvIG1ha2UgY3VzdG9tIGNoYW5nZXMgdG8geW91ciBlbnZpcm9ubWVudCwgYXMgdGhpcwojIHdpbGwgcHJldmVudCB0aGUgbmVlZCBmb3IgbWVyZ2luZyBpbiBmdXR1cmUgdXBkYXRlcy4KCiMgUHJldmVudCBkb3VibGVzb3VyY2luZwppZiBbIC16ICIkQkFTSFJDU09VUkNFRCIgXTsgdGhlbgogIEJBU0hSQ1NPVVJDRUQ9IlkiCgogICMgYXJlIHdlIGFuIGludGVyYWN0aXZlIHNoZWxsPwogIGlmIFsgIiRQUzEiIF07IHRoZW4KICAgIGlmIFsgLXogIiRQUk9NUFRfQ09NTUFORCIgXTsgdGhlbgogICAgICBjYXNlICRURVJNIGluCiAgICAgIHh0ZXJtKnx2dGUqKQogICAgICAgIGlmIFsgLWUgL2V0Yy9zeXNjb25maWcvYmFzaC1wcm9tcHQteHRlcm0gXTsgdGhlbgogICAgICAgICAgICBQUk9NUFRfQ09NTUFORD0vZXRjL3N5c2NvbmZpZy9iYXNoLXByb21wdC14dGVybQogICAgICAgIGVsaWYgWyAiJHtWVEVfVkVSU0lPTjotMH0iIC1nZSAzNDA1IF07IHRoZW4KICAgICAgICAgICAgUFJPTVBUX0NPTU1BTkQ9Il9fdnRlX3Byb21wdF9jb21tYW5kIgogICAgICAgIGVsc2UKICAgICAgICAgICAgUFJPTVBUX0NPTU1BTkQ9J3ByaW50ZiAiXDAzM10wOyVzQCVzOiVzXDAwNyIgIiR7VVNFUn0iICIke0hPU1ROQU1FJSUuKn0iICIke1BXRC8jJEhPTUUvXH59IicKICAgICAgICBmaQogICAgICAgIDs7CiAgICAgIHNjcmVlbiopCiAgICAgICAgaWYgWyAtZSAvZXRjL3N5c2NvbmZpZy9iYXNoLXByb21wdC1zY3JlZW4gXTsgdGhlbgogICAgICAgICAgICBQUk9NUFRfQ09NTUFORD0vZXRjL3N5c2NvbmZpZy9iYXNoLXByb21wdC1zY3JlZW4KICAgICAgICBlbHNlCiAgICAgICAgICAgIFBST01QVF9DT01NQU5EPSdwcmludGYgIlwwMzNrJXNAJXM6JXNcMDMzXFwiICIke1VTRVJ9IiAiJHtIT1NUTkFNRSUlLip9IiAiJHtQV0QvIyRIT01FL1x+fSInCiAgICAgICAgZmkKICAgICAgICA7OwogICAgICAqKQogICAgICAgIFsgLWUgL2V0Yy9zeXNjb25maWcvYmFzaC1wcm9tcHQtZGVmYXVsdCBdICYmIFBST01QVF9DT01NQU5EPS9ldGMvc3lzY29uZmlnL2Jhc2gtcHJvbXB0LWRlZmF1bHQKICAgICAgICA7OwogICAgICBlc2FjCiAgICBmaQogICAgIyBUdXJuIG9uIHBhcmFsbGVsIGhpc3RvcnkKICAgIHNob3B0IC1zIGhpc3RhcHBlbmQKICAgIGhpc3RvcnkgLWEKICAgICMgVHVybiBvbiBjaGVja3dpbnNpemUKICAgIHNob3B0IC1zIGNoZWNrd2luc2l6ZQogICAgWyAiJFBTMSIgPSAiXFxzLVxcdlxcXCQgIiBdICYmIFBTMT0iW1x1QFxoIFxXXVxcJCAiCiAgICAjIFlvdSBtaWdodCB3YW50IHRvIGhhdmUgZS5nLiB0dHkgaW4gcHJvbXB0IChlLmcuIG1vcmUgdmlydHVhbCBtYWNoaW5lcykKICAgICMgYW5kIGNvbnNvbGUgd2luZG93cwogICAgIyBJZiB5b3Ugd2FudCB0byBkbyBzbywganVzdCBhZGQgZS5nLgogICAgIyBpZiBbICIkUFMxIiBdOyB0aGVuCiAgICAjICAgUFMxPSJbXHVAXGg6XGwgXFddXFwkICIKICAgICMgZmkKICAgICMgdG8geW91ciBjdXN0b20gbW9kaWZpY2F0aW9uIHNoZWxsIHNjcmlwdCBpbiAvZXRjL3Byb2ZpbGUuZC8gZGlyZWN0b3J5CiAgZmkKCiAgaWYgISBzaG9wdCAtcSBsb2dpbl9zaGVsbCA7IHRoZW4gIyBXZSdyZSBub3QgYSBsb2dpbiBzaGVsbAogICAgIyBOZWVkIHRvIHJlZGVmaW5lIHBhdGhtdW5nZSwgaXQgZ2V0cyB1bmRlZmluZWQgYXQgdGhlIGVuZCBvZiAvZXRjL3Byb2ZpbGUKICAgIHBhdGhtdW5nZSAoKSB7CiAgICAgICAgY2FzZSAiOiR7UEFUSH06IiBpbgogICAgICAgICAgICAqOiIkMSI6KikKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgICopCiAgICAgICAgICAgICAgICBpZiBbICIkMiIgPSAiYWZ0ZXIiIF0gOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgUEFUSD0kUEFUSDokMQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIFBBVEg9JDE6JFBBVEgKICAgICAgICAgICAgICAgIGZpCiAgICAgICAgZXNhYwogICAgfQoKICAgICMgQnkgZGVmYXVsdCwgd2Ugd2FudCB1bWFzayB0byBnZXQgc2V0LiBUaGlzIHNldHMgaXQgZm9yIG5vbi1sb2dpbiBzaGVsbC4KICAgICMgQ3VycmVudCB0aHJlc2hvbGQgZm9yIHN5c3RlbSByZXNlcnZlZCB1aWQvZ2lkcyBpcyAyMDAKICAgICMgWW91IGNvdWxkIGNoZWNrIHVpZGdpZCByZXNlcnZhdGlvbiB2YWxpZGl0eSBpbgogICAgIyAvdXNyL3NoYXJlL2RvYy9zZXR1cC0qL3VpZGdpZCBmaWxlCiAgICBpZiBbICRVSUQgLWd0IDE5OSBdICYmIFsgImAvdXNyL2Jpbi9pZCAtZ25gIiA9ICJgL3Vzci9iaW4vaWQgLXVuYCIgXTsgdGhlbgogICAgICAgdW1hc2sgMDA3CiAgICBlbHNlCiAgICAgICB1bWFzayAwMjcKICAgIGZpCgogICAgU0hFTEw9L2Jpbi9iYXNoCiAgICAjIE9ubHkgZGlzcGxheSBlY2hvcyBmcm9tIHByb2ZpbGUuZCBzY3JpcHRzIGlmIHdlIGFyZSBubyBsb2dpbiBzaGVsbAogICAgIyBhbmQgaW50ZXJhY3RpdmUgLSBvdGhlcndpc2UganVzdCBwcm9jZXNzIHRoZW0gdG8gc2V0IGVudnZhcnMKICAgIGZvciBpIGluIC9ldGMvcHJvZmlsZS5kLyouc2g7IGRvCiAgICAgICAgaWYgWyAtciAiJGkiIF07IHRoZW4KICAgICAgICAgICAgaWYgWyAiJFBTMSIgXTsgdGhlbgogICAgICAgICAgICAgICAgLiAiJGkiCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIC4gIiRpIiA+L2Rldi9udWxsCiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKICAgIGRvbmUKCiAgICB1bnNldCBpCiAgICB1bnNldCAtZiBwYXRobXVuZ2UKICBmaQoKZmkKIyB2aW06dHM9NDpzdz00Cg==
        mode: 420
        overwrite: true
        path: /etc/bashrc
      - contents:
          compression: ""
          source: data:text/plain;charset=utf-8;base64,IyEgL2Jpbi9iYXNoCgpjaG1vZCA2MDAgL2V0Yy9jbmkvbmV0LmQvKgpjaG1vZCA2MDAgL2V0Yy9rdWJlcm5ldGVzL3N0YXRpYy1wb2QtcmVzb3VyY2VzL2t1YmUtY29udHJvbGxlci1tYW5hZ2VyLXBvZC0qL2NvbmZpZ21hcHMvY29udHJvbGxlci1tYW5hZ2VyLWt1YmVjb25maWcva3ViZWNvbmZpZwpjaG1vZCA2MDAgL2V0Yy9rdWJlcm5ldGVzL21hbmlmZXN0cy9ldGNkLXBvZC55YW1sCmNobW9kIDYwMCAvZXRjL2t1YmVybmV0ZXMvc3RhdGljLXBvZC1yZXNvdXJjZXMva3ViZS1hcGlzZXJ2ZXItcG9kLSova3ViZS1hcGlzZXJ2ZXItcG9kLnlhbWwKY2htb2QgNjAwIC9ldGMva3ViZXJuZXRlcy9zdGF0aWMtcG9kLXJlc291cmNlcy9rdWJlLWNvbnRyb2xsZXItbWFuYWdlci1wb2QtKi9rdWJlLWNvbnRyb2xsZXItbWFuYWdlci1wb2QueWFtbApjaG1vZCA2MDAgL2V0Yy9rdWJlcm5ldGVzL3N0YXRpYy1wb2QtcmVzb3VyY2VzL2t1YmUtc2NoZWR1bGVyLXBvZC0qL2NvbmZpZ21hcHMvc2NoZWR1bGVyLWt1YmVjb25maWcva3ViZWNvbmZpZw==
        mode: 493
        overwrite: true
        path: /usr/local/bin/compliance_permission_modify
    systemd:
      units:
      - contents: |
          [Unit]
          Description=Compliance Permission Modification Service
          After=network.target

          [Service]
          Type=oneshot
          ExecStart=/usr/local/bin/compliance_permission_modify

          [Install]
          WantedBy=multi-user.target
        enabled: true
        name: compliance.service
      - contents: |
          [Unit]
          Description=Daily Compliance Permission Modification At Midnight

          [Timer]
          OnCalendar=daily
          RandomizedDelaySec=30m

          [Install]
          WantedBy=timers.target
        enabled: true
        name: compliance.timer
